extends ../../layouts/default.pug

block main
    if(cartDetail.products.length > 0)
        form(action="/checkout/order" method="POST")
            .row
                //- CỘT TRÁI: THÔNG TIN GIAO HÀNG & THANH TOÁN
                .col-12.col-lg-7
                    //- 1. Thông tin người nhận
                    .card.border-0.shadow-sm.rounded-3.mb-4
                        .card-header.bg-white.py-3
                            h5.mb-0.fw-bold Thông tin người nhận
                        .card-body.p-4
                            .row.g-3
                                .col-12
                                    label.form-label.fw-bold(for="fullName") Họ và tên <span class="text-danger">*</span>
                                    input.form-control(
                                        type="text" 
                                        id="fullName" 
                                        name="fullName" 
                                        required 
                                        placeholder="Nhập họ tên của bạn"
                                        value=(user ? user.fullName : "")
                                    )
                                
                                .col-12.col-md-6
                                    label.form-label.fw-bold(for="phone") Số điện thoại <span class="text-danger">*</span>
                                    input.form-control(
                                        type="text" 
                                        id="phone" 
                                        name="phone" 
                                        required 
                                        placeholder="Số điện thoại nhận hàng"
                                        value=(user ? user.phone : "")
                                    )
                                
                                .col-12.col-md-6
                                    label.form-label.fw-bold(for="email") Email
                                    input.form-control(
                                        type="email" 
                                        id="email" 
                                        name="email" 
                                        placeholder="Để nhận thông báo đơn hàng"
                                        value=(user ? user.email : "")
                                    )
                                
                                .col-12
                                    label.form-label.fw-bold(for="address") Địa chỉ nhận hàng <span class="text-danger">*</span>
                                    input.form-control(
                                        type="text" 
                                        id="address" 
                                        name="address" 
                                        required 
                                        placeholder="Số nhà, đường, phường/xã, quận/huyện..."
                                        value=(user ? user.address : "")
                                    )
                                
                                .col-12
                                    label.form-label.fw-bold(for="note") Ghi chú đơn hàng
                                    textarea.form-control(
                                        id="note" 
                                        name="note" 
                                        rows="2" 
                                        placeholder="Ví dụ: Giao giờ hành chính, gọi trước khi giao..."
                                    )

                    //- 2. Phương thức thanh toán
                    .card.border-0.shadow-sm.rounded-3.mb-4
                        .card-header.bg-white.py-3
                            h5.mb-0.fw-bold Phương thức thanh toán
                        .card-body.p-4
                            .payment-methods
                                //- Option 1: COD
                                label.payment-item.d-flex.align-items-center.p-3.border.rounded-3.mb-3.cursor-pointer
                                    input.form-check-input.mt-0.me-3(
                                        type="radio" 
                                        name="paymentMethod" 
                                        value="COD" 
                                        checked
                                    )
                                    div
                                        span.fw-bold.d-block Thanh toán khi nhận hàng (COD)
                                        small.text-muted Bạn chỉ phải thanh toán khi đã nhận được hàng.
                                    i.fas.fa-money-bill-wave.ms-auto.text-success.fs-4

                                //- Option 2: Banking (Ví dụ)
                                label.payment-item.d-flex.align-items-center.p-3.border.rounded-3.cursor-pointer
                                    input.form-check-input.mt-0.me-3(
                                        type="radio" 
                                        name="paymentMethod" 
                                        value="VNPAY"
                                    )
                                    div
                                        span.fw-bold.d-block Chuyển khoản ngân hàng
                                        small.text-muted Thanh toán qua VNPAY / Ngân hàng
                                    i.fas.fa-university.ms-auto.text-primary.fs-4

                //- CỘT PHẢI: TÓM TẮT ĐƠN HÀNG (STICKY)
                .col-12.col-lg-5
                    .card.border-0.shadow-sm.rounded-3.sticky-top(style="top: 90px; z-index: 1;")
                        .card-header.bg-white.py-3
                            h5.mb-0.fw-bold Đơn hàng của bạn
                        
                        .card-body.p-4
                            //- List sản phẩm (Mini view)
                            .checkout-product-list.mb-3
                                each item in cartDetail.products
                                    .d-flex.align-items-center.mb-3
                                        img.rounded.border(
                                            src=item.productInfo.thumbnail 
                                            alt=item.productInfo.title 
                                            style="width: 60px; height: 60px; object-fit: cover;"
                                        )
                                        .ms-3.flex-grow-1
                                            h6.fw-bold.mb-0.text-truncate(style="max-width: 200px;") #{item.productInfo.title}
                                            if(item.color)
                                                span.text-muted.small Màu: #{item.color} / Size: #{item.size} / Số lượng: #{item.quantity}
                                            
                                            
                                        .fw-bold.text-end #{(item.totalPrice).toLocaleString()}đ
                            
                            hr
                            
                            //- Tính toán tiền
                            .d-flex.justify-content-between.mb-2
                                span.text-muted Tạm tính:
                                span.fw-medium #{cartDetail.totalPrice.toLocaleString()}đ
                            
                            .d-flex.justify-content-between.mb-2
                                span.text-muted Phí vận chuyển:
                                span.text-success Miễn phí
                            
                            hr
                            
                            .d-flex.justify-content-between.align-items-center.mb-4
                                span.fw-bold.fs-5 Tổng cộng:
                                span.fw-bold.fs-3.text-primary #{cartDetail.totalPrice.toLocaleString()}đ
                            
                            button.btn.btn-primary.w-100.py-3.rounded-pill.fw-bold.text-uppercase.btn-place-order(type="submit")
                                | Đặt hàng ngay

    else
        .alert.alert-warning.text-center
            | Giỏ hàng của bạn đang trống. Vui lòng thêm sản phẩm trước khi thanh toán.
            br
            a.btn.btn-primary.mt-3(href="/products") Quay lại cửa hàng